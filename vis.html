<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="js/firebase.js"></script>
    <script src="js/jquery-2.1.4.min.js"></script>

    <link href="css/fireworks.css" rel="stylesheet">
    <link href="css/knapp.css" rel="stylesheet"/>

    <style>

        @import url(http://fonts.googleapis.com/css?family=Roboto:400);

        .effect {
            display: none;
        }

        body {
            color: white;
            font-family: 'Roboto', sans-serif;
            background: #000;
        }


        #global-container {
            bottom: 0;
            left: 0;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 1000;
        }

        #global-container .container {

            margin: 20% auto;
            padding: 16px 32px 16px;
            position: relative;
            width: 70%;
            z-index: 1200;
            text-align: center;
        }

        a {
            color: white;
        }

        .circle
        {
            width:500px;
            height:500px;
            border-radius:50%;
            font-size:50px;
            color:#fff;
            line-height:500px;
            text-align:center;
            background:red
        }

        h1,h3{
            font-size: 4em;
        }

        .hidden {
            display: none;
        }

    </style>
</head>


<body>

<section id="fireworks"></section>

<section>
    <div class="container">
        <div class=round>
            <input type=checkbox id=onoff name=onoff onclick="kjor()"/>
            <div class=back>
                <label class=but for=onoff>
                    <span class=off>START</span>
                    <span class=on>STOPP</span>
                </label>
            </div>
        </div>
    </div>
</section>

<section id="global-container">

    <div class="container" id="paa">

        <div class="effect ding" data-time="3000">
            <h3>Oj!</h3>
        </div>
        <div class="effect" data-time="2000">
            <h3>Noen har trykket på START</h3>
        </div>
        <div class="effect" data-time="2000">
            <h3>Det kan bare være...</h3>
        </div>
        <div class="effect" data-time="2000">
            <h3>FINANSMINISTEREN</h3>
        </div>
        <div class="effect" data-time="1000">
            <h3>JENSEN</h3>
        </div>
        <div class="effect" data-time="1000">
            <h3>SIV</h3>
        </div>
        <div class="effect" data-time="2000">
            <h3>JENSEN</h3>
        </div>
        <div class="effect" data-time="600">
            <h3>Da</h3>
        </div>
        <div class="effect" data-time="600">
            <h3>må</h3>
        </div>
        <div class="effect" data-time="600">
            <h3>vi</h3>
        </div>
        <div class="effect" data-time="600">
            <h3>starte</h3>
        </div>
        <div class="effect" data-time="1000">
            <h3>PROD</h3>
        </div>
        <div class="effect" data-time="1000">
            <h3>!!!</h3>
        </div>
        <div class="effect">
            <h3>1: Bygger koden</h3>
        </div>
        <div class="effect">
            <h3>2: Mekker veiledningstekster</h3>
        </div>
        <div class="effect">
            <h3>3: Kjører 5233,5 automatiske tester</h3>
        </div>
        <div class="effect">
            <h3>Alt er bra så langt</h3>
        </div>
        <div class="effect">
            <h3>4: Mekker leveransepakke</h3>
        </div>
        <div class="effect">
            <h3>5: Deployer leveransepakken til AT</h3>
        </div>
        <div class="effect">
            <h3>6: Setter opp enda ett nytt MAP-mønster</h3>
        </div>
        <div class="effect" data-time="3000">
            <h3>Venter på at Heidi tester og sier ok</h3>
        </div>
        <div class="effect" data-time="3000">
            <img src="images/heidi_go.png" height="400px"/>
        </div>
        <div class="effect">
            <h3>Heidi sa OK!</h3>
        </div>
        <div class="effect" data-time="1000">
            <h3>Da må rådene godkjenne</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Løsningsråd</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Kvalitetsråd</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Kommunikasjonsstabsrådet</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> råd for Intern Kommunikasjon</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> råd for Ekstern Kommunikasjon</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> SITS Avviksråd</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> SKD Avviksråd</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Myklerådet</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> råd for Generisk Metamodell Skatt</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Endringsråd</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Endringsstyringsråd</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Designrådet</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Change Management</h3>
        </div>
        <div class="effect nofade" data-time="400">
            <h3>Får godkjenning i<br /> Sjefsrådet</h3>
        </div>
        <div class="effect nofade" data-time="300">
            <h3>Får godkjenning i<br /> ...</h3>
        </div>
        <div class="effect nofade" data-time="1000">
            <h3>Alle godkjenninger på plass (tror vi)</h3>
        </div>
        <div class="effect modemstart"  data-time="10000">
            <h3>Sender leveransepakken til drift i Grimstad</h3>
        </div>
        <div class="effect">
            <h3>Vi har kontakt med tåka i Grimstad</h3>
        </div>
        <div class="effect">
            <h3>Leveransepakken er i tåka</h3>
        </div>
        <div class="effect">
            <h3>Leveransepakken har nådd skyen</h3>
        </div>
        <div class="effect">
            <h3>Grimstad trykker på START</h3>
        </div>
        <div class="effect">
            <h3>Grimstad sier at Næringsrapport Skatt er startet</h3>
        </div>
        <div class="effect" data-time="2300">
            <img src="websurfin.gif" height="400px"/>
        </div>
        <div class="effect modemstop">
            <h3>Næringsrapport Skatt er klar for hordene!</h3>
        </div>
        <div class="effect" data-time="2500">
            <h3>Da er det bare å lene seg tilbake og nyte magien!</h3>
        </div>
        <div class="effect fireworks" data-time="4400">
            <img src="elsa.gif" height="400px" />
        </div>
        <div class="effect box last">
            <h3><a href="https://skatt.skatteetaten.no/web/elsa/">Vi er i PROD</a></h3>
        </div>

    </div>
    <div class="container" style="display: none" id="av">
        <h3>Næringsrapport Skatt er STOPPET</h3>
    </div>



</section>


<script type="application/javascript">

    var fb = new Firebase("https://intense-fire-5133.firebaseio.com");
    var running = false;
    var startTime, stopTime;

    console.log("Starter app");
    fb.on("value", function(data) {
        console.log("Data er mottatt");
        var erPaa = data.val() ? data.val().kjorer : "";

        skrupaa(erPaa);
    });

    $('body').click(function(){
        skrupaa(!running)
    });

    function skrupaa(erPaa){
        if(erPaa){
            console.log("Skiten er på");
            startTime = Date.now();
            $('#onoff').prop('checked', true);
            $('.round').addClass('green');
            $('#status').toggleClass('yellow');


            start();
        } else {
            console.log("Skiten er av");
            $('#onoff').prop('checked', false);
            $('.round').removeClass('green');
            $('#fireworks canvas').remove();

            running = false;
            $('#paa').hide();
            $('#starter').hide();
            $('.effect').hide();
            $('#av').show();

            stoppLyd('ding_mp3');
            stoppLyd('modem_mp3');
            stoppLyd('modem_mp3');
            stoppLyd('fireworks_mp3');

        }
    }

    function stoppLyd(id) {
        var el = document.getElementById(id);

        if(el) {
            el.pause();
        }
    }


    function start(){
        if(running){
            return;
        }

        running = true;

        $('#av').hide();
        $('.active').removeClass('active');
        $('#paa').show();

        aapneNesteEffekt();
    }

    function aapneNesteEffekt(){
        if(!running){
            return;
        }

        var aktive = $('.effect.active');
        var neste, aktiv;


        if(aktive.length > 0){
            aktiv = aktive.first();
            aktiv.removeClass('active');
            aktive.hide();
            neste = aktiv.next()
        } else {
            neste = $('.effect').first();
        }

        neste.addClass('active');
        if(neste.hasClass('nofade')) {
            neste.show();
        } else {
            neste.fadeIn();
        }

        var tid = neste.attr('data-time');

        timeout = 1500;
        if(tid){
            timeout = tid;
        }

        if(neste.hasClass('ding')){
            document.getElementById('ding_mp3').currentTime = 0;
            document.getElementById('ding_mp3').play();
        }
        if(neste.hasClass('modemstart')){
            document.getElementById('modem_mp3').currentTime = 0;
            document.getElementById('modem_mp3').play();
        }
        if(neste.hasClass('modemstop')){
            document.getElementById('modem_mp3').pause();
        }
        if(neste.hasClass('fireworks')){
            document.getElementById('fireworks_mp3').currentTime = 0;
            document.getElementById('fireworks_mp3').play();
        }

        if(!neste.hasClass('last')){
            window.setTimeout(aapneNesteEffekt, timeout);
        } else {
            Fireworks.initialize();
            stopTime = Date.now();
            var brukt = (stopTime - startTime)/1000;

            console.log("Kjøringa tok " + brukt + "s");

            window.setTimeout(fyr, 2000);
        }
    }

    function fyr(){
        console.log("bang");
        Fireworks.createParticle();

        var lenge = Math.round(Math.random()*1500) + 1;

        window.setTimeout(fyr, lenge);
    }



</script>

<aside id="library">
    <img src="images/big-glow.png" id="big-glow" />
    <img src="images/small-glow.png" id="small-glow" />

    <audio id="modem_mp3" src="modem.mp3" type="audio/mpeg" />
    <audio id="ding_mp3" src="ching.mp3" type="audio/mpeg" />
    <audio id="fireworks_mp3" src="fireworks.mp3" type="audio/mpeg" />

</aside>
</body>
<script src="js/requestanimframe.js"></script>
<script src="js/fireworks.js"></script>

</body>

</html>
